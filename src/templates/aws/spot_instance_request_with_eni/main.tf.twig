resource "aws_spot_instance_request" "{{ name }}" {
  ami                     = "${var.instance_ami}"
  instance_type           = "${var.instance_instance_type}"
  key_name                = "${var.instance_key_name}"
  iam_instance_profile    = "${var.instance_iam_instance_profile}"

  network_interface {
     network_interface_id  = "${var.instance_network_interface_id}"
     device_index          = "${var.instance_device_index}"
     delete_on_termination = "${var.instance_delete_on_termination}"
  }

  ebs_block_device{
      device_name           = "${var.instance_ebs_device_name}"
      volume_type           = "${var.instance_ebs_volume_type}"
      volume_size           = "${var.instance_ebs_volume_size}"
      delete_on_termination = "${var.instance_ebs_delete_on_termination}"
      encrypted             = "${var.instance_ebs_encrypted}"
  }
  
  ebs_optimized           = "${var.instance_ebs_optimized}"
  disable_api_termination = "${var.instance_disable_api_termination}"
  user_data               = "${data.template_file.user_data.rendered}"
  monitoring              = "${var.instance_monitoring}"
  
  spot_price             = "${var.instance_spot_price}"
  wait_for_fulfillment   = "${var.instance_wait_for_fulfillment}"
  spot_type              = "${var.instance_spot_type}"
  launch_group           = "${var.instance_launch_group}"
  block_duration_minutes = "${var.instance_block_duration_minutes}"

  tags = "${merge(var.default_tags, var.custom_tags)}"
}