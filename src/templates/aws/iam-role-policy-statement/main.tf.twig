module "iam_policy" {
  providers = {
    aws = "aws.default"
  }
  account_id = "${var.account_id}"
  region = "${var.region}"
  source          = "./iam-policy"
  iam_policy_name = "${var.iam_policy_name}"
}

resource "aws_iam_role" "{{ name }}" {
  provider           = "aws.default"
  name               = "${var.iam_role_name}"
  description        = "${var.iam_role_description}"
  path               = "${var.iam_role_path}"
  assume_role_policy = "${data.aws_iam_policy_document.default_assume_role_policy.json}"
}

resource "aws_iam_role_policy_attachment" "role_attach_{{ name }}" {
  provider   = "aws.default"
  role       = "${aws_iam_role.{{ name }}.name}"
  policy_arn = "${module.iam_policy.aws_policy_arn}"
}
